<html>
    <head>
        <title>Gazetteer administration application help</title>
        <link rel="stylesheet" href="help.css" />
        <script type="text/javascript" src="jquery-1.7.2.min.js"></script>
        <script type="text/javascript" src="help.js"></script>
    </head>
    <body>
        <h1>Gazetteer administration application help</h1>
        <h2>Starting the gazetteer application</h2>
        <p>
        The gazetteer application is started by either running from the Plugin menu (Plugins | Gazetteer editor | Open the gazetteer editor) or by clicking the <img class="icon"src="../icon.png" /> gazetteer icon.  
        </p>
        <p>
        This will open the Gazetteer editor window and add the gazetteer map layers to the map.  The editor window is a dockable window - it can be dragged off the main QGIS window.
        </p>
        <h2>The gazetteer map layers</h2>
        <p>
        The gazetteer application uses 8 layers in two groups - one for the currently selected feature, and one for the current search results
        </p>
        <p>
        In each group are four layers
        <ul>
            <li>refpt layer: a point layer defining the reference point for the feature.  Each feature must have a single reference point.</li>
            <li>point, line, and polygon layers: are layers of shapes defining the extents of the feature.  Each feature can have as many points, lines, and polygons as needed to define it (including none).  Each layer in QGIS can contain only one type of geometry (points, lines, or polygons), so there are three layers to define feature geometries.
            </li>
        </ul>
        <h2>Finding names</h2>
        <p>
        You can find names by entering the name into the the search box (on the search tab of the editor) and clicking the search button. 
        Names will be found that contain every complete word in the search string.  Diacritical marks and case (upper/lower case) are ignored in matching words.
        There are a couple of useful shortcuts in searching for names:
        <ul>
        <li>You can end a search term with '*' to search for all words starting with the beginning of the name, for example &quot;taumatawhakatangi*&quot; to search for a very long name</li>
        <li>If you know the database id of a name you can just enter that instead of the name.  Enter id=value to look up a name id, or fid=value to look up a feature id.
        These must be entered without any spaces (ie fid&nbsp;=value will not work).</li>
        <li>If you have looked at the name recently, then you may find it in the &quot;Recent&quot; tab</li>
        </ul>
        </p>
        <p>The search box also has a button to switch to &quot;advanced&quot; search mode.  In this mode
        you can restrict the search in a number of ways..
        <ul>
            <li>By feature class/type (feature class is a broad grouping of feature types)</li>
            <li>By name status.  This includes groupings of official status's, unofficial status's and 
            unpublished status's.  (Unpublished status's are new and deleted).</li>
            <li>By limiting the search to the area currently viewed on the map</li>
        </ul>
        </p>
        <p>You can also used the advanced search box to increase the maximum number of names that can be
        returned.  
        </p>
        <p>If too many names match the search criteria then you will get an error message &quot;Query not specific enough&quot;.  You can make the search more specific to reduce the number of matches, or use the advanced search option to increase the maximum permitted.
        </p>
        <p>Once a name is found you can click the name in the results list to see all of its details.  
        The matched names are also displayed on the map, and you can use the identify search tool to select a name to display from the map.  Start the identify search tool by clicking <img class="icon"src="../searchpointer.png" />.  Then hover over a search result on the map to see its name displayed in the status bar on the bottom of the map window, or click it to view its details.
        </p>
        <p>Normally when you click a name in the list its details will replace those of the last name viewed.  However you can display the name in a new window by holding down the shift key when clicking.
        </p>
        <p>Note that if you delete a name (set its status to deleted), then the only way to find it is to
        enter its id into the search box, or to use the advanced search setting the name status to deleted.
        </p>
        <p>The search tab itself has two other tabs, Recent and Favourites.  Use Recent to find names that you have edited or viewed recently, and favourites to view names that you have tagged as favourites (see Editing names below).
        The Recent tab provides options for &quot;Any user&quot;, to look at names that any user has viewed or edited recently, and &quot;Edited only&quot;, to restrict the list to names that have been edited.
        </p>
        <h2>Editing names</h2>
        <p>The details of a name are displayed in a window by clicking a name in the search results or
        clicking a search result on the map. 
        The name details window can be dragged off (undocked from) the search window, and several names detail can be viewed at once.
        </p>
        <p>
        If the feature to which the name refers has other names, then you can click their links to view their details.
        </p>
        <p>
        At the top of the name details list are two numbers - the name and feature id which are generally not useful (!), an Edit button, and a start. Click the star to add the name to your favourites list if you are going to want to see it again (and click it again to remove it).
        </p>
        <p>
        When you click the edit button you put the name into &quot;edit mode&quot;.  Here you can edit all details of the name and feature, and add new events, annotations, and associated names.
        </p>
        <p>
        To edit an item click its the corresponding &quot;edit&quot; link, and then make the required changes.  Click the save button at the top to save the changes, or the Cancel button to undo all changes to the name.  
        </p>
        <p>Note that to associate a name with another name (which is not a name for teh same feature), you must first open the other name in a name window (ie search for it and click the result).  You can then select that name in the "Create new assocation" window"
        </p>

        <h2>Creating new names and features</h2>
        <p>You can create a new name for an existing feature by editing one of the existing names, cliccking the &quot;create new name for this feature&quot; link, and entering the name.  After you have saved the chagnes, you can click on the link for the new name to open it, and do any other edits required
        </p>
        <p>
        To create a completely new feature click the <img class="icon"src="../newfeat.png" /> icon, then click the map at the location of the reference point for the new feature.  You will be prompted for the name of the feature, and the feature class/type.  Select these and click Ok to create the new feature and name.
        </p>
        <p>
        Once you have created the new name you can then edit its details.  Initially the name is created with a status of &quot;New name&quot;.  While it is in this status you can change the name.  Once you set its status to any other value (official or unofficial), then the name can no longer be edited.  Names with status &quot;New name&quot; will not be published to the web or LINZ data service.
        </p>
        <p>
        Note that you must define the &quot;process&quot; associated with a name before
        you can change the status to anything other than New or Deleted.
        </p>
        <h2>Deleting names</h2>
        <p>
        To delete a name, go into edit mode and set its status to &quot;Deleted name&quot;.  It will then
        not published, and will not show in the administration application unless you explicitely search for deleted names.
        </p>
        <h2>Editing feature geometries (spatial definition)</h2>
        <p>To edit a feature you must first select it so that it is shown in the &quot;gazetteer feature&quot; layers on the map.  You can then select one of the layers (refpoint, point, line, polygon) to edit or create spatial objects in that layer.  After making spatial edits, click the 
<img class="icon"src="../editsave.png" /> icon to save the changes, or 
<img class="icon"src="../editcancel.png" /> to cancel them.
</p>

        <table>
<tr><td><img class="icon"src="../editnew.png" /></td>
<td>
Add a new point line or polygon to the feature.  First select the point, line, or polygon layer, then click the icon, then digitize features onto the map.  Just click the map (with the left button) to create a point.
To create a line or polygon click a series of points, and then click with the right button to complete the feature.
</td></tr>
<tr><td><img class="icon"src="../addselected.png" /></td>
<td>
Import geometries selected in other layers into the feature.  To use this first select features in another layer using the Quantum feature selection tools, then click this button to add them to this feature.
</td></tr>
<tr><td><img class="icon"src="../delselected.png" /></td>
<td>
    Delete geometries from the feature.  To use this, select the geometries of the feature in the point/line, or polygon layers with the Quantum feature selection tools, then click this button to remove them from the feature.
</td></tr>
<tr><td><img class="icon"src="../editshift.png" /></td>
<td>
    Shift a point, line, polygon or the reference point.  Select the layer of the geometry that you want to move, then click this icon.  You can then drag features around.
</td></tr>
<tr><td><img class="icon"src="../editnodes.png" /></td>
<td>
    Shift the nodes of a line or polygon.  Select the layer of the geometries that you want to edit, click this tool.  Click a geometry to start editing it, then drag nodes around to where you want them to be.
</td></tr>
        </table>
        <h2>Publishing data</h2>
        <p>Periodically the gazetteer data used by the web application and LINZ data service needs to be  updated, in order to publish new names. 
        Note that some names are not published.  Any name with a status of &quot;New name&quot; or &quot;Deleted name&quot; is not published.  
        Also any name with a &quot;Not published&quot; annotation of either the name or the feature it refers to will not be published.
        You can check which names are not published using the advanced search options.
        </p>
        
        <p>To publish data to the web database and LINZ data service (not yet implemented)
        open the Administration function dialog, 
        accessed from the <span class="menu">Plugins | Gazetteer editor | Administration functions</span> menu.  Only gazetteer administrators can use these functions. This opens the administration dialog.
        </p>
        <p>
        Open the &quot;Publish gazetteer data&quot; tab and 
        click the &quot;Publish data&quot; button, to start the update. 
        The update may take several minutes to run.  During this time the online
        application may not be able to access the data.
        </p>
        <h2>Adding and removing users</h2>
        <p>The gazetteer application can only be used by registered users.  Users
        are either normal users, or administrators.  Administrators can publish
        data, add and remove users, and update lists such as feature type and name
        status lists.
        </p>
        <p>All users must have LINZ logins - they are identified by their network 
        login in the gazetteer database.
        </p>
        <p>
        To add new users or change users from normal to adminstrator groups use the
        Administration dialog,
        accessed from the <span class="menu">Plugins | Gazetteer editor | Administration functions</span> menu.  Only gazetteer administrators can use these functions. This opens the administration dialog.
        </p>
        <p>
        Select the &quot;Users&quot; tab.  This will display a list of users.  
        </p>
        <p>
        To add a new user, click enter their network userid in the User name box and click the &quot;Add&quot; button.  
        </p>
        <p>To remove a user, select them from the drop down list and click the &quot;Remove&quot; button.
        </p>
        <p>To grant or revoke a users administator status, select the user, set or clear the &quot;Admin userK&quot; check box, and then click the &quot;Update&quot; button.
        </p>
        <p>Note that you cannot change any settings for yourself!</p>

        <h2>Updating system codes</h2>
        <p>Updating system codes should generally be done with great care!  This 
        function is only available to administrators, and updating some system codes 
        can stop the application operating correctly
        </p>
        <p>
        Changes that can be achieved using system codes are:
        </p>
        <ul>
            <li>Adding a new event type.  To add a new event type you need to alter the following system codes
            <ul>
                <li>NEVT: defines the new event type</li>
                <li>APEA: defines the authorities for which the event applies</li>
                <li>APEV: defines a regular expression used to validate the value entered by the user for the event type (not for the faint of heart).</li>
            </ul>
            </li>
            <li>Defining feature types not to be exported. Add an entry in the
            XNPV system code group defining the feature type code not to be 
            published.  The value is ignored, but sensibly will describe the 
            the feature type, and the description will indicate why it is not
            being published
            </li>
        </ul>
        <h2>Installing/updating the application</h2>
        <p>
        The gazetteer application is installed from the LINZ Customer services plugin repository.  The plugin is installed using the <span class="menu">Plugins | Fetch Python plugins</span> menu item. 
        </p>
        <p>If the plugin is already installed, but is not showing then it may need to be enabled.  Use the <span class="menu">Plugins | Manage plugins</span> menu item to open the plugins dialog, and click the checkbox for the Gazetteer editor plugin.
        </p>
        <p>
        Some guidance on system maintenance is avaiable in <a href="devnotes.html">developer notes</a>.
        </p>

    </body>
</html>
